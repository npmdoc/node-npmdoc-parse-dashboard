<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/ParsePlatform/parse-dashboard">parse-dashboard (v1.0.25)</a>
</h1>
<h4>The Parse Dashboard</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.parse-dashboard">module parse-dashboard</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.parse-dashboard.parse-dashboard">
            function <span class="apidocSignatureSpan"></span>parse-dashboard
            <span class="apidocSignatureSpan">(config, allowInsecureHTTP)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.parse-dashboard.Authentication">
            function <span class="apidocSignatureSpan">parse-dashboard.</span>Authentication
            <span class="apidocSignatureSpan">(validUsers, useEncryptedPasswords, mountPath)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">parse-dashboard.</span>Authentication.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.parse-dashboard.Authentication">module parse-dashboard.Authentication</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.parse-dashboard.Authentication.Authentication">
            function <span class="apidocSignatureSpan">parse-dashboard.</span>Authentication
            <span class="apidocSignatureSpan">(validUsers, useEncryptedPasswords, mountPath)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.parse-dashboard.Authentication.prototype">module parse-dashboard.Authentication.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.parse-dashboard.Authentication.prototype.authenticate">
            function <span class="apidocSignatureSpan">parse-dashboard.Authentication.prototype.</span>authenticate
            <span class="apidocSignatureSpan">(userToTest, usernameOnly)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.parse-dashboard.Authentication.prototype.initialize">
            function <span class="apidocSignatureSpan">parse-dashboard.Authentication.prototype.</span>initialize
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.parse-dashboard" id="apidoc.module.parse-dashboard">module parse-dashboard</a></h1>


    <h2>
        <a href="#apidoc.element.parse-dashboard.parse-dashboard" id="apidoc.element.parse-dashboard.parse-dashboard">
        function <span class="apidocSignatureSpan"></span>parse-dashboard
        <span class="apidocSignatureSpan">(config, allowInsecureHTTP)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parse-dashboard = function (config, allowInsecureHTTP) {
  var app = express();
  // Serve public files.
  app.use(express.static(path.join(__dirname,'public')));

  // Allow setting via middleware
  if (config.trustProxy &amp;&amp; app.disabled('trust proxy')) {
    app.enable('trust proxy');
  }

  // wait for app to mount in order to get mountpath
  app.on('mount', function() {
    const mountPath = getMount(app.mountpath);
    const users = config.users;
    const useEncryptedPasswords = config.useEncryptedPasswords ? true : false;
    const authInstance = new Authentication(users, useEncryptedPasswords, mountPath);
    authInstance.initialize(app);

    // CSRF error handler
    app.use(function (err, req, res, next) {
      if (err.code !== 'EBADCSRFTOKEN') return next(err)

      // handle CSRF token errors here
      res.status(403)
      res.send('form tampered with')
    });

    // Serve the configuration.
    app.get('/parse-dashboard-config.json', function(req, res) {
      let response = {
        apps: config.apps,
        newFeaturesInLatestVersion: newFeaturesInLatestVersion,
      };

      //Based on advice from Doug Wilson here:
      //https://github.com/expressjs/express/issues/2518
      const requestIsLocal =
        req.connection.remoteAddress === '127.0.0.1' ||
        req.connection.remoteAddress === '::ffff:127.0.0.1' ||
        req.connection.remoteAddress === '::1';
      if (!requestIsLocal &amp;&amp; !req.secure &amp;&amp; !allowInsecureHTTP) {
        //Disallow HTTP requests except on localhost, to prevent the master key from being transmitted in cleartext
        return res.send({ success: false, error: 'Parse Dashboard can only be remotely accessed via HTTPS' });
      }

      if (!requestIsLocal &amp;&amp; !users) {
        //Accessing the dashboard over the internet can only be done with username and password
        return res.send({ success: false, error: 'Configure a user to access Parse Dashboard remotely' });
      }

      const authentication = req.user;

      const successfulAuth = authentication &amp;&amp; authentication.isAuthenticated;
      const appsUserHasAccess = authentication &amp;&amp; authentication.appsUserHasAccessTo;

      if (successfulAuth) {
        if (appsUserHasAccess) {
          // Restric access to apps defined in user dictionary
          // If they didn't supply any app id, user will access all apps
          response.apps = response.apps.filter(function (app) {
            return appsUserHasAccess.find(appUserHasAccess =&gt; {
              return app.appId == appUserHasAccess.appId
            })
          });
        }
        // They provided correct auth
        return res.json(response);
      }

      if (users) {
        //They provided incorrect auth
        return res.sendStatus(401);
      }

      //They didn't provide auth, and have configured the dashboard to not need auth
      //(ie. didn't supply usernames and passwords)
      if (requestIsLocal) {
        //Allow no-auth access on localhost only, if they have configured the dashboard to not need auth
        return res.json(response);
      }
      //We shouldn't get here. Fail closed.
      res.send({ success: false, error: 'Something went wrong.' });
    });

    // Serve the app icons. Uses the optional `iconsFolder` parameter as
    // directory name, that was setup in the config file.
    // We are explicitly not using `__dirpath` here because one may be
    // running parse-dashboard from globally installed npm.
    if (config.iconsFolder) {
      try {
        var stat = fs.statSync(config.iconsFolder);
        if (stat.isDirectory()) {
          app.use('/appicons', express.static(config.iconsFolder));
          //Check also if the icons really exist
          checkIfIconsExistForApps(config.apps, config.iconsFolder);
        }
      } catch (e) {
        // Directory doesn't exist or something.
        console.warn("Iconsfolder at path: " + config.iconsFolder +
          " not found!");
      }
    }

    app.get('/login', csrf(), function(req, res) {
      if (!users || (req.user &amp;&amp; req.user.isAuthenticated)) {
        return res.redirec ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.parse-dashboard.Authentication" id="apidoc.element.parse-dashboard.Authentication">
        function <span class="apidocSignatureSpan">parse-dashboard.</span>Authentication
        <span class="apidocSignatureSpan">(validUsers, useEncryptedPasswords, mountPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Authentication(validUsers, useEncryptedPasswords, mountPath) {
  this.validUsers = validUsers;
  this.useEncryptedPasswords = useEncryptedPasswords || false;
  this.mountPath = mountPath;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.parse-dashboard.Authentication" id="apidoc.module.parse-dashboard.Authentication">module parse-dashboard.Authentication</a></h1>


    <h2>
        <a href="#apidoc.element.parse-dashboard.Authentication.Authentication" id="apidoc.element.parse-dashboard.Authentication.Authentication">
        function <span class="apidocSignatureSpan">parse-dashboard.</span>Authentication
        <span class="apidocSignatureSpan">(validUsers, useEncryptedPasswords, mountPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Authentication(validUsers, useEncryptedPasswords, mountPath) {
  this.validUsers = validUsers;
  this.useEncryptedPasswords = useEncryptedPasswords || false;
  this.mountPath = mountPath;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.parse-dashboard.Authentication.prototype" id="apidoc.module.parse-dashboard.Authentication.prototype">module parse-dashboard.Authentication.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.parse-dashboard.Authentication.prototype.authenticate" id="apidoc.element.parse-dashboard.Authentication.prototype.authenticate">
        function <span class="apidocSignatureSpan">parse-dashboard.Authentication.prototype.</span>authenticate
        <span class="apidocSignatureSpan">(userToTest, usernameOnly)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function authenticate(userToTest, usernameOnly) {
  var appsUserHasAccessTo = null;
  var matchingUsername = null;

  //they provided auth
  let isAuthenticated = userToTest &amp;&amp;
    //there are configured users
    this.validUsers &amp;&amp;
    //the provided auth matches one of the users
    this.validUsers.find(user =&gt; {
      let isAuthenticated = false;
      let usernameMatches = userToTest.name == user.user;
      let passwordMatches = this.useEncryptedPasswords &amp;&amp; !usernameOnly ? bcrypt.compareSync(userToTest.pass, user.pass) : userToTest
.pass == user.pass;
      if (usernameMatches &amp;&amp; (usernameOnly || passwordMatches)) {
        isAuthenticated = true;
        matchingUsername = user.user;
        // User restricted apps
        appsUserHasAccessTo = user.apps || null;
      }

      return isAuthenticated;
    }) ? true : false;

  return {
    isAuthenticated,
    matchingUsername,
    appsUserHasAccessTo
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.mountPath = mountPath;
}

function initialize(app) {
var self = this;
passport.use('local', new LocalStrategy(
  function(username, password, cb) {
    var match = self.<span class="apidocCodeKeywordSpan">authenticate</span>({
      name: username,
      pass: password
    });
    if (!match.matchingUsername) {
      return cb(null, false, { message: 'Invalid username or password' });
    }
    cb(null, match.matchingUsername);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.parse-dashboard.Authentication.prototype.initialize" id="apidoc.element.parse-dashboard.Authentication.prototype.initialize">
        function <span class="apidocSignatureSpan">parse-dashboard.Authentication.prototype.</span>initialize
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function initialize(app) {
  var self = this;
  passport.use('local', new LocalStrategy(
    function(username, password, cb) {
      var match = self.authenticate({
        name: username,
        pass: password
      });
      if (!match.matchingUsername) {
        return cb(null, false, { message: 'Invalid username or password' });
      }
      cb(null, match.matchingUsername);
    })
  );

  passport.serializeUser(function(username, cb) {
    cb(null, username);
  });

  passport.deserializeUser(function(username, cb) {
    var user = self.authenticate({
      name: username
    }, true);
    cb(null, user);
  });

  app.use(require('connect-flash')());
  app.use(require('body-parser').urlencoded({ extended: true }));
  app.use(require('cookie-session')({
    key    : 'parse_dash',
    secret : 'magic',
    cookie : {
      maxAge: (2 * 7 * 24 * 60 * 60 * 1000) // 2 weeks
    }
  }));
  app.use(passport.initialize());
  app.use(passport.session());

  app.post('/login',
    csrf(),
    passport.authenticate('local', {
      successRedirect: `${self.mountPath}apps`,
      failureRedirect: `${self.mountPath}login`,
      failureFlash : true
    })
  );

  app.get('/logout', function(req, res){
    req.logout();
    res.redirect(`${self.mountPath}login`);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  // wait for app to mount in order to get mountpath
  app.on('mount', function() {
    const mountPath = getMount(app.mountpath);
    const users = config.users;
    const useEncryptedPasswords = config.useEncryptedPasswords ? true : false;
    const authInstance = new Authentication(users, useEncryptedPasswords, mountPath);
    authInstance.<span class="apidocCodeKeywordSpan">initialize</span>(app);

    // CSRF error handler
    app.use(function (err, req, res, next) {
if (err.code !== 'EBADCSRFTOKEN') return next(err)

// handle CSRF token errors here
res.status(403)
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>